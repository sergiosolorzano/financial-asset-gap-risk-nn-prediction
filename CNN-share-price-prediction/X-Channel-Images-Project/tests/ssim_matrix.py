import numpy as np
import matplotlib.pyplot as plt

class TickerHeatmapGenerator:
    def __init__(self, tickers, save_path="ssim_map_with_values.png"):
        """
        Initialize the heatmap generator.
        :param tickers: List of ticker symbols.
        :param save_path: Path to save the heatmap image.
        """
        self.tickers = tickers
        self.matrix_size = len(tickers)
        self.matrix = np.zeros((self.matrix_size, self.matrix_size))
        self.save_path = save_path
        self.ticker_to_index = {ticker: idx for idx, ticker in enumerate(tickers)}

    def update_value(self, ticker1, ticker2, value):
       
        if ticker1 in self.ticker_to_index and ticker2 in self.ticker_to_index:
            
            i = self.ticker_to_index[ticker1]
            j = self.ticker_to_index[ticker2]
            self.matrix[i, j] = value
            self.matrix[j, i] = value  # To keep the matrix symmetric
            
            print(f"Updated value for pair ({ticker1}, {ticker2}) = {value}")
        else:
            
            print(f"Error: One or both tickers not found: {ticker1}, {ticker2}")

    def generate_heatmap(self):
        """
        Generate and save the heatmap displaying values only.
        """
        fig, ax = plt.subplots(figsize=(12, 10))
        ax.axis('off')  # Turn off the axes

        # Display the matrix values as a table
        table_data = np.round(self.matrix, 3).tolist()
        table = ax.table(cellText=table_data,
                         rowLabels=self.tickers,
                         colLabels=self.tickers,
                         cellLoc='center',
                         loc='center')

        table.auto_set_font_size(False)
        table.set_fontsize(10)

        # Save the table to the specified file
        plt.title("SSIM Matrix with Values")
        plt.savefig(self.save_path, dpi=300)
        print(f"Heatmap saved as {self.save_path}")

        # Show the plot
        plt.show()


if __name__ == "__main__":
    # List of tickers
    tickers = ["SIVBQ", "SICPQ", "ALLY", "CMA", "WAL", "PWBK", 
               "ZION", "KEY", "CUBI", "OZK", "CFG", "RF", "FITB", "HBAN"]

    # Initialize the heatmap generator
    heatmap = TickerHeatmapGenerator(tickers)

    # The nested structure of SSIM data you provided
    #2021 data
    ssim_data_nested = [[[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.3704536259174347], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.48212066292762756], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.3736174404621124], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4726531207561493], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.05071616545319557], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.38753578066825867], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4010263979434967], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4249544143676758], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4123328626155853], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.3778620958328247], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.3904111087322235], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4399232864379883], [[{'ticker': 'SIVBQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.38596341013908386], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.31234076619148254], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.2613639831542969], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.3275105059146881], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.09146274626255035], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.2505556643009186], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.24370315670967102], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.3042617440223694], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.249998539686203], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.21221822500228882], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.24619060754776], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.24346484243869781], [[{'ticker': 'SICPQ', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.2658926248550415], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4802308678627014], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.49428844451904297], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.06526217609643936], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4841848909854889], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.48306146264076233], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4544219970703125], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.43080028891563416], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.48274415731430054], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.42207205295562744], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4809723496437073], [[{'ticker': 'ALLY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4561319947242737], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.533659815788269], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.07645225524902344], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.7216663360595703], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6517255306243896], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.45770058035850525], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4675182104110718], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5821740627288818], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5938384532928467], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6300323009490967], [[{'ticker': 'CMA', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5203545093536377], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.05302180349826813], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5266730189323425], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5666338801383972], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.504608154296875], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5270249247550964], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5098334550857544], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5368549823760986], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5580867528915405], [[{'ticker': 'WAL', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5140599012374878], [[{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.07537403702735901], [[{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.06922992318868637], [[{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.03235507756471634], [[{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.04861287400126457], [[{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.056576650589704514], [[{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.06506425887346268], [[{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.05417218804359436], [[{'ticker': 'PWBK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.051518842577934265], [[{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6150786876678467], [[{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.46293795108795166], [[{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.453029990196228], [[{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5414749383926392], [[{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6064474582672119], [[{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5648069977760315], [[{'ticker': 'ZION', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.4894666075706482], [[{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5418223738670349], [[{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5948302149772644], [[{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.7987590432167053], [[{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6577513813972473], [[{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.7285614609718323], [[{'ticker': 'KEY', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6704742312431335], [[{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5304791331291199], [[{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5309602618217468], [[{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.471529483795166], [[{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5471972227096558], [[{'ticker': 'CUBI', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5295976400375366], [[{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.5620689392089844], [[{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6122348308563232], [[{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6004860997200012], [[{'ticker': 'OZK', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6062372922897339], [[{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6275138854980469], [[{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.7221697568893433], [[{'ticker': 'CFG', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6877825260162354], [[{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6540189981460571], [[{'ticker': 'RF', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.6430084705352783], [[{'ticker': 'FITB', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2021-12-06', 'end_date': '2023-01-25'}], 0.673761785030365]]

    #2020 Data
    # ssim_data_nested = [[[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.30802151560783386], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4118920862674713], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.38917282223701477], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4946666955947876], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.06904341280460358], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.38719838857650757], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.40320926904678345], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.3656514585018158], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.40296119451522827], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.39184778928756714], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4295039176940918], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.41233423352241516], [[{'ticker': 'SIVBQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.348347008228302], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.24401643872261047], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.2288084328174591], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.26593300700187683], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.06803479790687561], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.22915495932102203], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.22232815623283386], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.2618294656276703], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.23090961575508118], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.21596509218215942], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.23887842893600464], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.21931739151477814], [[{'ticker': 'SICPQ', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.22382624447345734], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4472920596599579], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4270499050617218], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.06144992634654045], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.43122398853302], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.465359628200531], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.3980933129787445], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.3961264193058014], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.46513059735298157], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4276770353317261], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4695740342140198], [[{'ticker': 'ALLY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4050685167312622], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.49814939498901367], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.06149667501449585], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.7112569212913513], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.7051681876182556], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4368424415588379], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4985155463218689], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6486509442329407], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.65876704454422], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6868796348571777], [[{'ticker': 'CMA', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5637499690055847], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.04480700194835663], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5037649273872375], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5196665525436401], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4302300214767456], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4914173483848572], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.499971866607666], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5219641923904419], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.510822057723999], [[{'ticker': 'WAL', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4628601670265198], [[{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.07206427305936813], [[{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.0653669536113739], [[{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.04000941291451454], [[{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.05937761068344116], [[{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.05543133616447449], [[{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.06827432662248611], [[{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.056948643177747726], [[{'ticker': 'PWBK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.05937996879220009], [[{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6356002688407898], [[{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.44048136472702026], [[{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5139492750167847], [[{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6237580180168152], [[{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6559708118438721], [[{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.642498254776001], [[{'ticker': 'ZION', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5554117560386658], [[{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.47342634201049805], [[{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5598890781402588], [[{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.7506243586540222], [[{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6998071074485779], [[{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.7310176491737366], [[{'ticker': 'KEY', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6229863166809082], [[{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4846314787864685], [[{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.48739373683929443], [[{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.4732614755630493], [[{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5043019652366638], [[{'ticker': 'CUBI', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.42182183265686035], [[{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5389789342880249], [[{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.596993625164032], [[{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5547912120819092], [[{'ticker': 'OZK', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.5370219349861145], [[{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6652100682258606], [[{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.7224699854850769], [[{'ticker': 'CFG', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6297347545623779], [[{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6671769618988037], [[{'ticker': 'RF', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6115391254425049], [[{'ticker': 'FITB', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], [{'ticker': 'HBAN', 'start_date': '2020-12-06', 'end_date': '2023-01-25'}], 0.6379230618476868]] 

    # Flatten the nested structure if it comes as multiple chunks (as suggested by your data)
    # If your data is truly just one large list, you can skip this flatten step.
    # For demonstration, assuming ssim_data_nested is a list of lists of entries:
    ssim_data_flat = ssim_data_nested  # No need to flatten if it's already correctly structured

    for entry in ssim_data_flat:
        ticker1 = entry[0][0]['ticker']
        ticker2 = entry[1][0]['ticker']
        ssim_value = entry[2]
        heatmap.update_value(ticker1, ticker2, ssim_value)

        for ticker in tickers:
            heatmap.update_value(ticker, ticker, 1)

    # Generate and save the heatmap
    heatmap.generate_heatmap()
